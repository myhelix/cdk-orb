description: >
  cdk deploy

executor: default

parameters:
  cdk-directory:
    description: the directory where your cdk app resides
    type: string
    default: "."
  cdk-params:
    description: the parameters to pass your cdk command
    type: string
    default: "--all --require-approval=never --ci --progress=events "
  aws_access_key_id:
    default: AWS_ACCESS_KEY_ID
    description: |
      AWS access key id for IAM role. Set this to the name of the environment variable you will set to hold this value, i.e. AWS_ACCESS_KEY.
    type: env_var_name
  aws_account_id:
    default: AWS_ACCOUNT_ID
    description: |
      Name of environment variable storing the Amazon account ID.
    type: env_var_name
  aws_secret_access_key:
    default: AWS_SECRET_ACCESS_KEY
    description: |
      AWS secret key for IAM role. Set this to the name of the environment variable you will set to hold this value, i.e. AWS_SECRET_ACCESS_KEY.
    type: env_var_name
  environment:
    default: ENVIRONMENT
    description: The environment to apply on.
    type: string
  notify:
    default: false
    description: whether to notify slack
    type: boolean
  working-directory:
    default: ~/workdir
    description: where to attach_workspace
    type: string

steps:
  - cdk:
      cdk-command: deploy
      cdk-directory: << parameters.cdk-directory >>
      cdk-params: << parameters.cdk-params >>
      aws_access_key_id: << parameters.aws_access_key_id >>
      aws_account_id: << parameters.aws_account_id >>
      aws_secret_access_key: << parameters.aws_secret_access_key >>
      environment: << parameters.environment >>
      notify: << parameters.notify >>
      working-directory: << parameters.working-directory >>
